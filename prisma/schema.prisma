generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AISummary {
  id          String   @id @default(cuid())
  caseId      String   @unique
  summary     String
  keyPoints   String
  insights    String
  generatedAt DateTime @default(now())
  updatedAt   DateTime @updatedAt
  Case        Case     @relation(fields: [caseId], references: [id], onDelete: Cascade)

  @@index([caseId])
}

model Case {
  id            String         @id @default(cuid())
  caseNumber    String         @unique
  clientName    String
  clientEmail   String?
  clientPhone   String?
  caseTitle     String
  description   String?
  status        CaseStatus     @default(ACTIVE)
  priority      Priority       @default(MEDIUM)
  createdById   String
  firmId        String
  opponents     String?
  courtName     String?
  judgeAssigned String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  AISummary     AISummary?
  User          User           @relation(fields: [createdById], references: [id])
  Firm          Firm           @relation(fields: [firmId], references: [id], onDelete: Cascade)
  FileDocument  FileDocument[]
  Hearing       Hearing[]

  @@index([caseNumber])
  @@index([createdById])
  @@index([firmId])
  @@index([status])
}

model FileDocument {
  id         String   @id @default(cuid())
  caseId     String
  fileName   String
  fileUrl    String
  fileType   String
  fileSize   Int
  uploadedAt DateTime @default(now())
  Case       Case     @relation(fields: [caseId], references: [id], onDelete: Cascade)

  @@index([caseId])
}

model Firm {
  id                      String   @id @default(cuid())
  name                    String
  address                 String?
  phone                   String?
  email                   String?
  ownerId                 String   @unique
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  Case                    Case[]
  User_Firm_ownerIdToUser User     @relation("Firm_ownerIdToUser", fields: [ownerId], references: [id])
  User_User_firmIdToFirm  User[]   @relation("User_firmIdToFirm")

  @@index([ownerId])
}

model Hearing {
  id           String         @id @default(cuid())
  caseId       String
  hearingDate  DateTime
  hearingTime  String?
  hearingType  HearingType    @default(ARGUMENTS)
  courtRoom    String?
  notes        String?
  status       HearingStatus  @default(SCHEDULED)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  Case         Case           @relation(fields: [caseId], references: [id], onDelete: Cascade)
  Reminder     Reminder[]
  CalendarSync CalendarSync[]

  @@index([caseId])
  @@index([hearingDate])
}

model GoogleCalendarToken {
  id           String   @id @default(cuid())
  userId       String   @unique
  accessToken  String   @db.Text
  refreshToken String   @db.Text
  expiresAt    DateTime
  calendarId   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model CalendarSync {
  id            String   @id @default(cuid())
  hearingId     String
  googleEventId String   @unique
  lastSyncedAt  DateTime @default(now())
  syncStatus    String   @default("SYNCED")
  errorMessage  String?
  Hearing       Hearing  @relation(fields: [hearingId], references: [id], onDelete: Cascade)

  @@index([hearingId])
  @@index([googleEventId])
}

model Reminder {
  id           String         @id @default(cuid())
  hearingId    String
  reminderType ReminderType   @default(ONE_DAY_BEFORE)
  reminderTime DateTime
  status       ReminderStatus @default(PENDING)
  sentAt       DateTime?
  createdAt    DateTime       @default(now())
  Hearing      Hearing        @relation(fields: [hearingId], references: [id], onDelete: Cascade)

  @@index([hearingId])
  @@index([reminderTime])
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model User {
  id                      String               @id @default(cuid())
  email                   String               @unique
  name                    String?
  password                String?              // Nullable for Google OAuth users
  googleId                String?              @unique // Google 'sub' identifier for OAuth
  firmId                  String?
  role                    UserRole             @default(ADVOCATE)
  createdAt               DateTime             @default(now())
  updatedAt               DateTime             @updatedAt
  Case                    Case[]
  Firm_Firm_ownerIdToUser Firm?                @relation("Firm_ownerIdToUser")
  Session                 Session[]
  Firm_User_firmIdToFirm  Firm?                @relation("User_firmIdToFirm", fields: [firmId], references: [id])
  GoogleCalendarToken     GoogleCalendarToken?

  @@index([email])
  @@index([firmId])
  @@index([googleId])
}

enum CaseStatus {
  ACTIVE
  PENDING_JUDGMENT
  CONCLUDED
  APPEAL
  DISMISSED
}

enum HearingStatus {
  SCHEDULED
  POSTPONED
  COMPLETED
  CANCELLED
}

enum HearingType {
  ARGUMENTS
  EVIDENCE_RECORDING
  FINAL_HEARING
  INTERIM_HEARING
  JUDGMENT_DELIVERY
  PRE_HEARING
  OTHER
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ReminderStatus {
  PENDING
  SENT
  FAILED
}

enum ReminderType {
  ONE_DAY_BEFORE
  THREE_DAYS_BEFORE
  ONE_WEEK_BEFORE
  CUSTOM
}

enum UserRole {
  ADVOCATE
  ADMIN
  SUPPORT_STAFF
}
